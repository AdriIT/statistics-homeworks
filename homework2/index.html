<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Homework 2 - Dataset e Distribuzioni</title>
  <style>
    body {
      font-family: 'Inter', system-ui, sans-serif;
      background-color: #0f1724;
      color: #e6eef6;
      line-height: 1.6;
      margin: 0;
      padding: 0;
    }
    header {
      text-align: center;
      background-color: #0b1220;
      padding: 40px 20px;
      border-bottom: 2px solid #7dd3fc;
    }
    h1 { color: #7dd3fc; font-size: 2rem; margin-bottom: 8px; }
    p.lead { color: #9aa6b2; font-size: 1rem; }
    section {
      max-width: 900px;
      margin: 40px auto;
      background-color: #0b1220;
      border-radius: 14px;
      box-shadow: 0 0 20px rgba(0,0,0,0.3);
      padding: 24px;
    }
    h2 { color: #7dd3fc; margin-top: 0; font-size: 1.3rem; }
    textarea, select, input, button {
      background: #111a2b;
      color: #e6eef6;
      border: 1px solid #7dd3fc;
      border-radius: 6px;
      padding: 8px;
      width: 100%;
      margin-top: 8px;
      margin-bottom: 12px;
    }
    button {
      cursor: pointer;
      background: #7dd3fc;
      color: #0f1724;
      font-weight: bold;
      transition: 0.3s;
    }
    button:hover { background: #56b8e8; }
    canvas {
      background: #111a2b;
      display: block;
      margin: 10px auto;
      border-radius: 10px;
    }
    footer {
      text-align: center;
      color: #9aa6b2;
      margin: 40px 0 20px;
      font-size: 0.9rem;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      text-align: center;
      margin-top: 10px;
    }
    th, td {
      border: 1px solid #7dd3fc;
      padding: 6px;
    }
    th { background: #111a2b; }
  </style>
</head>
<body>

<header>
  <h1>Laboratorio Interattivo: Dataset e Distribuzioni</h1>
  <p class="lead">Un percorso guidato tra concetti statistici, dati reali e crittografia.</p>
</header>

<section>
  <h2>1. Cos’è un Dataset</h2>
  <p>Un <strong>dataset</strong> è una raccolta strutturata di dati, spesso organizzata in forma tabellare.  
  Ogni riga rappresenta un’osservazione (ad esempio un utente o un evento), e ogni colonna una variabile misurata (es. Paese, browser, esito, ecc.).</p>
  <p>I dataset sono alla base di ogni analisi statistica: permettono di individuare schemi, tendenze e anomalie.</p>
</section>

<section>
  <h2>2. Cos’è una Distribuzione Statistica</h2>
  <p>Una <strong>distribuzione</strong> mostra come si ripetono i valori di una variabile all’interno di un dataset.  
  Può essere univariata (una sola variabile) o bivariata (relazione tra due variabili).  
  Le distribuzioni aiutano a capire la forma dei dati, la loro variabilità e le relazioni tra variabili.</p>
</section>

<section>
  <h2>3. Analisi Univariata</h2>
  <p>Seleziona una variabile (k ≤ 3) per calcolare la sua distribuzione univariata.</p>

  <table id="LoginAttempts">
    <thead>
      <tr><th>UserID</th><th>Country</th><th>Browser</th><th>Success</th></tr>
    </thead>
    <tbody>
      <tr><td>1</td><td>Italy</td><td>Chrome</td><td>1</td></tr>
      <tr><td>2</td><td>Germany</td><td>Firefox</td><td>0</td></tr>
      <tr><td>1</td><td>Italy</td><td>Edge</td><td>0</td></tr>
      <tr><td>3</td><td>USA</td><td>Chrome</td><td>1</td></tr>
      <tr><td>2</td><td>Germany</td><td>Safari</td><td>1</td></tr>
      <tr><td>4</td><td>France</td><td>Chrome</td><td>0</td></tr>
      <tr><td>3</td><td>USA</td><td>Firefox</td><td>1</td></tr>
    </tbody>
  </table>

  <label>Seleziona la variabile:</label>
  <select id="uniSelect">
    <option value="Country">Country</option>
    <option value="Browser">Browser</option>
    <option value="Success">Success</option>
  </select>
  <button onclick="computeUnivariate()">Calcola distribuzione</button>
  <canvas id="uniChart" width="600" height="200"></canvas>
</section>

<section>
  <h2>4. Analisi Bivariata</h2>
  <p>Ora osserviamo la relazione tra due variabili selezionate dal dataset.</p>
  <label>Variabile X:</label>
  <select id="biSelectX">
    <option value="Country">Country</option>
    <option value="Browser">Browser</option>
    <option value="Success">Success</option>
  </select>
  <label>Variabile Y:</label>
  <select id="biSelectY">
    <option value="Browser">Browser</option>
    <option value="Country">Country</option>
    <option value="Success">Success</option>
  </select>
  <button onclick="computeBivariate()">Calcola distribuzione bivariata</button>
  <div id="biResult"></div>
</section>

<section>
  <h2>5. Analisi del Testo e Cifrario di Cesare</h2>
  <p>Scrivi un testo, visualizza la distribuzione delle lettere, cifralo con uno shift segreto e prova a decodificarlo automaticamente!</p>

  <textarea id="textInput" rows="3">Cybersecurity relies on statistics and data.</textarea>
  <button onclick="analyzeLetters()">Mostra distribuzione lettere</button>
  <canvas id="letterChart" width="600" height="200"></canvas>

  <h3>Cifrario di Cesare</h3>
  <label>Shift (nascosto all’analisi):</label>
  <input type="number" id="shiftInput" value="5" min="1" max="25">
  <button onclick="encryptText()">Cifra</button>
  <textarea id="encryptedOutput" rows="3" readonly></textarea>

  <h3>Decodifica senza sapere lo shift</h3>
  <button onclick="bruteForceDecrypt()">Prova tutti gli shift</button>
  <textarea id="bruteOutput" rows="3" readonly></textarea>

  <h3>Decodifica tramite distribuzione linguistica</h3>
  <select id="langSelect">
    <option value="english">Inglese</option>
    <option value="italian">Italiano</option>
  </select>
  <button onclick="languageDecrypt()">Decifra</button>
  <textarea id="langOutput" rows="3" readonly></textarea>
</section>



<script>
// ---- FUNZIONE GENERICA PER DISEGNO GRAFICI ----
function drawBarChart(freq, canvasId) {
  const canvas = document.getElementById(canvasId);
  const ctx = canvas.getContext("2d");
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  const labels = Object.keys(freq);
  const values = Object.values(freq);
  const max = Math.max(...values);
  const barWidth = canvas.width / labels.length;

  labels.forEach((l, i) => {
    const h = (values[i] / max) * canvas.height * 0.85;
    ctx.fillStyle = "#7dd3fc";
    ctx.fillRect(i * barWidth, canvas.height - h, barWidth - 2, h);
    ctx.fillStyle = "black";
    ctx.font = "12px sans-serif";
    ctx.fillText(l, i * barWidth + 3, canvas.height - 5);
  });
}

// ---- 3. DISTRIBUZIONE UNIVARIATA ----
function computeUnivariate() {
  const col = document.getElementById("uniSelect").value;
  const table = document.querySelectorAll("#LoginAttempts tbody tr");
  const idx = {UserID:1, Country:2, Browser:3, Success:4}[col];
  const freq = {};
  table.forEach(r => {
    const val = r.querySelector(`td:nth-child(${idx})`).textContent;
    freq[val] = (freq[val] || 0) + 1;
  });
  drawBarChart(freq, "uniChart");
}

// ---- 4. DISTRIBUZIONE BIVARIATA ----
function computeBivariate() {
  const x = document.getElementById("biSelectX").value;
  const y = document.getElementById("biSelectY").value;
  const idx = {UserID:1, Country:2, Browser:3, Success:4};
  const rows = document.querySelectorAll("#LoginAttempts tbody tr");
  const combo = {};
  rows.forEach(r => {
    const xv = r.querySelector(`td:nth-child(${idx[x]})`).textContent;
    const yv = r.querySelector(`td:nth-child(${idx[y]})`).textContent;
    const key = `${xv}-${yv}`;
    combo[key] = (combo[key] || 0) + 1;
  });
  let html = "<table><tr><th>" + x + "</th><th>" + y + "</th><th>Conteggio</th></tr>";
  for (const [k,v] of Object.entries(combo)) {
    const [xv, yv] = k.split("-");
    html += `<tr><td>${xv}</td><td>${yv}</td><td>${v}</td></tr>`;
  }
  html += "</table>";
  document.getElementById("biResult").innerHTML = html;
}

// ---- 5. ANALISI LETTERE E CIFRARIO ----
function analyzeLetters() {
  const text = document.getElementById("textInput").value.toUpperCase();
  const freq = {};
  for (let c of text) if(/[A-Z]/.test(c)) freq[c] = (freq[c]||0)+1;
  drawBarChart(freq, "letterChart");
}

function encryptText() {
  const shift = parseInt(document.getElementById("shiftInput").value);
  const text = document.getElementById("textInput").value.toUpperCase();
  const enc = text.replace(/[A-Z]/g, c => String.fromCharCode((c.charCodeAt(0)-65+shift)%26+65));
  document.getElementById("encryptedOutput").value = enc;
}

function bruteForceDecrypt() {
  const cipher = document.getElementById("encryptedOutput").value;
  let results = "";
  for(let s=1;s<26;s++){
    const dec = cipher.replace(/[A-Z]/g, c => String.fromCharCode((c.charCodeAt(0)-65-s+26)%26+65));
    results += `Shift ${s}: ${dec}\n`;
  }
  document.getElementById("bruteOutput").value = results;
}

const langFreq = {
  english: {E:12.7,T:9.1,A:8.2,O:7.5,I:7.0,N:6.7,S:6.3,H:6.1,R:6.0,D:4.3},
  italian: {E:11.8,A:11.7,I:10.1,O:9.8,N:6.9,T:6.2,R:6.1,L:5.8,S:4.9,C:4.5}
};

function languageDecrypt() {
  const cipher = document.getElementById("encryptedOutput").value;
  const lang = document.getElementById("langSelect").value;
  let bestShift=0, bestScore=Infinity;
  for(let s=0;s<26;s++){
    const dec = cipher.replace(/[A-Z]/g, c=>String.fromCharCode((c.charCodeAt(0)-65-s+26)%26+65));
    const freq = {};
    for(let ch of dec) if(/[A-Z]/.test(ch)) freq[ch]=(freq[ch]||0)+1;
    const total = Object.values(freq).reduce((a,b)=>a+b,0);
    let score=0;
    for(const [k,v] of Object.entries(langFreq[lang])) score+=Math.abs((freq[k]||0)/total*100-v);
    if(score<bestScore){bestScore=score;bestShift=s;}
  }
  const decrypted = cipher.replace(/[A-Z]/g,c=>String.fromCharCode((c.charCodeAt(0)-65-bestShift+26)%26+65));
  document.getElementById("langOutput").value = decrypted;
}
</script>

</body>
</html>
