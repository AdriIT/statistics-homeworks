<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Caesar Cipher con output lingua + brute force</title>
<style>
:root{
  --bg:#0f1724;
  --card:#0b1220;
  --muted:#9aa6b2;
  --accent:#7dd3fc;
  --radius:14px;
  --bar-color:#7dd3fc;
  --number-color:#ffffff;
  --letter-color:#000000;
}
*{box-sizing:border-box}
body{
  font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  background:var(--bg);
  color:#e6eef6;
  margin:0;
  padding:20px;
}
.wrap{max-width: 980px; margin:0 auto;}
h1,h2,h3,h4,h5{color:var(--accent); margin:0 0 8px 0;}
p{color:#d5dde6; margin:0 0 12px 0;}

.card{
  background:var(--card);
  border-radius:var(--radius);
  padding:20px;
  margin-bottom:20px;
  box-shadow: 0 0 0 1px rgba(255,255,255,0.05) inset;
}

textarea{
  width:100%;
  background:rgba(0,0,0,0.2);
  color:#fff;
  padding:10px;
  border-radius:10px;
  border:none;
  resize:vertical;
  font-size:15px;
}

input[type=number]{
  width:72px;
  padding:6px 8px;
  border-radius:8px;
  border:none;
  background:rgba(255,255,255,0.1);
  color:#fff;
}

button{
  background:var(--accent);
  color:#000;
  border:none;
  border-radius:10px;
  padding:8px 12px;
  font-weight:700;
  cursor:pointer;
}
button:hover{filter:brightness(0.95);}

.button-group{
  display:flex;
  flex-wrap:wrap;
  gap:8px 12px;
  align-items:center;
  margin:12px 0;
}
.button-group label{
  color:var(--muted);
}

/* Bars */
.bar-row{display:flex; align-items:center; gap:8px; margin:4px 0;}
.bar-label{width:28px; text-align:center; color:#cfd7df; font-weight:700;}
.bar-wrap{flex:1; height:18px; background:rgba(255,255,255,0.06); border-radius:5px; overflow:hidden;}
.bar-fill{height:100%; background:var(--bar-color);}
.bar-value{width:40px; text-align:right; color:var(--number-color); font-weight:700}

/* Language outputs layout */
.lang-outputs{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap:16px;
  margin-top:8px;
}
.lang-card{
  background:rgba(255,255,255,0.04);
  border-radius:12px;
  padding:12px;
}
.lang-meta{color:var(--muted); margin-bottom:6px}

/* Brute force list */
.brute-list .brute-row{
  display:flex;
  align-items:center;
  gap:8px;
  padding:6px 0;
  border-bottom:1px solid rgba(255,255,255,0.07);
}
.shift-badge{
  min-width:54px; text-align:center; font-weight:800;
  background:rgba(125,211,252,0.25); color:#fff; border-radius:8px; padding:3px 6px;
}
.decode-text{
  flex:1; overflow:hidden; white-space:nowrap; text-overflow:ellipsis;
  background:rgba(0,0,0,0.2); padding:6px 8px; border-radius:6px;
}
.copy-btn{
  background:var(--accent); color:#000; border:none; border-radius:8px; padding:6px 10px; cursor:pointer;
}

@media (max-width: 820px){
  .lang-outputs{grid-template-columns:1fr;}
}
</style>
</head>
<body>
  <div class="wrap">
    <div class="card" id="cipher-card">
      <h2>Caesar Cipher: lingue + brute force</h2>
      <p>Scrivi un testo, cifra con uno shift, poi decodifica con brute force o con due pannelli linguistici separati per Italiano ed English.</p>

      <textarea id="cipher-input" rows="6">Voglio bere il latte e poi guardare il browser in Italia.</textarea>

      <div class="button-group">
        <label>Shift:
          <input type="number" id="cipher-shift" value="3" min="0" max="25">
        </label>
        <button id="btn-encrypt">Encrypt</button>
        <button id="btn-bruteforce">Brute-force Decode</button>
        <button id="btn-decode-lang">Decode by Language</button>
      </div>

      <h4>Distribuzione lettere (input)</h4>
      <div id="letter-chart-input"></div>

      <h4>Testo cifrato</h4>
      <textarea id="cipher-output" rows="4" readonly></textarea>

      <h3>Output linguistici distinti</h3>
      <div class="lang-outputs">
        <div class="lang-card" id="lang-it-card">
          <h4>Italiano</h4>
          <div class="lang-meta">Stima shift: <span id="it-shift">-</span></div>
          <textarea id="it-decoded" rows="4" readonly></textarea>
          <h5>Frequenze (cipher)</h5>
          <div id="it-bars"></div>
        </div>

        <div class="lang-card" id="lang-en-card">
          <h4>English</h4>
          <div class="lang-meta">Estimated shift: <span id="en-shift">-</span></div>
          <textarea id="en-decoded" rows="4" readonly></textarea>
          <h5>Frequenze (cipher)</h5>
          <div id="en-bars"></div>
        </div>
      </div>

      <h3>Brute Force (26 tentativi)</h3>
      <details open>
        <summary>Mostra/Nascondi risultati</summary>
        <div id="brute-results" class="brute-list"></div>
      </details>
    </div>
  </div>

<script>
/* --- Utilities --- */
function countLetters(text){
  const counts={}; for(let i=0;i<26;i++) counts[String.fromCharCode(65+i)]=0;
  text.toUpperCase().split('').forEach(ch=>{ if(ch>='A'&&ch<='Z') counts[ch]++; });
  return counts;
}
function renderBars(counts, container){
  container.innerHTML='';
  const max = Math.max(1, ...Object.values(counts));
  Object.entries(counts).forEach(([letter,value])=>{
    const row=document.createElement('div'); row.className='bar-row';
    const lbl=document.createElement('div'); lbl.className='bar-label'; lbl.textContent=letter;
    const wrap=document.createElement('div'); wrap.className='bar-wrap';
    const fill=document.createElement('div'); fill.className='bar-fill'; fill.style.width=(value/max*100)+'%';
    const val=document.createElement('div'); val.className='bar-value'; val.textContent=value;
    wrap.appendChild(fill); row.appendChild(lbl); row.appendChild(wrap); row.appendChild(val);
    container.appendChild(row);
  });
}
function caesarShift(text,shift){
  return text.split('').map(ch=>{
    const c=ch.charCodeAt(0);
    if(c>=65&&c<=90) return String.fromCharCode((c-65+shift+26)%26+65);
    if(c>=97&&c<=122) return String.fromCharCode((c-97+shift+26)%26+97);
    return ch;
  }).join('');
}

/* --- Language profiles --- */
const langFreq = {
  italian:{A:11.7,B:0.9,C:4.5,D:3.7,E:11.8,F:1.2,G:1.6,H:0.6,I:10.1,L:6.5,M:2.5,N:6.9,O:9.8,P:3.0,Q:0.5,R:6.0,S:4.9,T:5.0,U:3.6,V:2.0,Z:1.2},
  english:{A:8.2,B:1.5,C:2.8,D:4.3,E:12.7,F:2.2,G:2.0,H:6.1,I:7.0,J:0.15,K:0.77,L:4.0,M:2.4,N:6.7,O:7.5,P:1.9,Q:0.095,R:6.0,S:6.3,T:9.1,U:2.8,V:0.98,W:2.4,X:0.15,Y:2.0,Z:0.074}
};

/* Align most frequent cipher letter to most frequent language letter */
function estimateShiftByLang(cipherCounts, lang){
  const topCipher = Object.entries(cipherCounts).sort((a,b)=>b[1]-a[1]).find(e=>e[1]>0);
  if(!topCipher) return { shift: 0 };
  const topCipherIdx = topCipher[0].charCodeAt(0)-65;
  const topLang = Object.entries(langFreq[lang]).sort((a,b)=>b[1]-a[1])[0][0];
  const topLangIdx = topLang.charCodeAt(0)-65;
  const shift = (topCipherIdx - topLangIdx + 26) % 26; // cipher = plain + shift
  return { shift };
}

/* Decode and render for a given language panel */
function decodeAndRenderForLang(lang, inputCipher, shiftElId, outElId, barsElId){
  const counts = countLetters(inputCipher);
  const { shift } = estimateShiftByLang(counts, lang);
  const decoded = caesarShift(inputCipher, (26 - shift) % 26);
  document.getElementById(shiftElId).textContent = String(shift);
  document.getElementById(outElId).value = decoded;
  renderBars(counts, document.getElementById(barsElId));
}

/* Brute force: list 26 shifts with copy buttons */
function renderBruteForce(cipher){
  const host = document.getElementById('brute-results');
  host.innerHTML = '';
  for(let s=0; s<26; s++){
    const row = document.createElement('div'); row.className='brute-row';
    const badge = document.createElement('div'); badge.className='shift-badge'; badge.textContent = 's='+s;
    const txt = document.createElement('div'); txt.className='decode-text';
    const decoded = caesarShift(cipher, (26 - s) % 26);
    txt.textContent = decoded;
    const btn = document.createElement('button'); btn.className='copy-btn'; btn.textContent='Copy';
    btn.addEventListener('click', ()=>navigator.clipboard.writeText(decoded));
    row.appendChild(badge); row.appendChild(txt); row.appendChild(btn);
    host.appendChild(row);
  }
}

/* Wire up UI */
(function wireCipherUI(){
  const inputEl = document.getElementById('cipher-input');
  const shiftEl = document.getElementById('cipher-shift');
  const outEl   = document.getElementById('cipher-output');

  const renderInputBars = ()=> renderBars(countLetters(inputEl.value), document.getElementById('letter-chart-input'));
  inputEl.addEventListener('input', renderInputBars);
  renderInputBars();

  document.getElementById('btn-encrypt').addEventListener('click', ()=>{
    const cipher = caesarShift(inputEl.value, Number(shiftEl.value)||0);
    outEl.value = cipher;
    // reset decode panels and brute list
    document.getElementById('it-shift').textContent='-';
    document.getElementById('en-shift').textContent='-';
    document.getElementById('it-decoded').value='';
    document.getElementById('en-decoded').value='';
    document.getElementById('it-bars').innerHTML='';
    document.getElementById('en-bars').innerHTML='';
    document.getElementById('brute-results').innerHTML='';
  });

  document.getElementById('btn-decode-lang').addEventListener('click', ()=>{
    const cipher = outEl.value || caesarShift(inputEl.value, Number(shiftEl.value)||0);
    decodeAndRenderForLang('italian', cipher, 'it-shift', 'it-decoded', 'it-bars');
    decodeAndRenderForLang('english', cipher, 'en-shift', 'en-decoded', 'en-bars');
  });

  document.getElementById('btn-bruteforce').addEventListener('click', ()=>{
    const cipher = outEl.value || caesarShift(inputEl.value, Number(shiftEl.value)||0);
    renderBruteForce(cipher);
  });
})();
</script>
</body>
</html>
