<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Interactive Statistics: Dataset & Distribution</title>
<style>
:root {
    --bg: #0f1724;
    --card: #0b1220;
    --muted: #9aa6b2;
    --accent: #7dd3fc;
    --radius: 14px;
    --bar-color: #800020;
    --number-color: #ffffff;
    --letter-color: #000000;
}
body {
    font-family: 'Inter', sans-serif;
    background: var(--bg);
    color: #e6eef6;
    margin:0;
    padding:0;
}
.wrap {
    max-width: 950px;
    margin:0 auto;
    padding:20px;
}
h1,h2,h3,h4 { color: var(--accent); }
.card {
    background: var(--card);
    border-radius: var(--radius);
    padding:20px;
    margin-bottom:20px;
}
table {
    width:100%;
    border-collapse: collapse;
    margin:10px 0;
}
th, td {
    border:1px solid #777;
    padding:6px 10px;
    text-align:center;
}
th { background: var(--accent); color:#000; }
.bar-row { display:flex; align-items:center; margin:4px 0; }
.bar-label { width:28px; color: var(--letter-color); font-weight:600; }
.bar-wrap { flex:1; background: rgba(255,255,255,0.05); border-radius:4px; margin:0 8px; }
.bar-fill { height:18px; border-radius:4px; background: var(--bar-color); }
.bar-value { width:48px; text-align:right; color: var(--number-color); font-weight:600; }
input[type=number] { width:60px; }
select, button { margin-left:6px; padding:4px 6px; border-radius:4px; border:none; }
textarea { width:100%; background:rgba(0,0,0,0.2); color:#fff; padding:0.5rem; border-radius:6px; }
</style>
</head>
<body>
<div class="wrap">
<header>
<h1>Interactive Statistics: Dataset & Distribution</h1>
<p>Learn how datasets and distributions work with practical examples and interactive visualizations.</p>
</header>

<div class="card">
<h2>1. What is a Dataset?</h2>
<p>A <strong>dataset</strong> is a structured collection of data organized in rows (observations) and columns (variables). It is the foundation for statistical analysis.</p>
</div>

<div class="card">
<h2>2. What is a Distribution?</h2>
<p>A <strong>distribution</strong> describes how values of a variable are spread. It can be visualized as frequencies, probabilities, or histograms to detect patterns or anomalies.</p>
</div>

<div class="card">
<h2>3. Example Dataset: Browser Visits by Country</h2>
<p>We track website visits by users with variables: <strong>Browser</strong>, <strong>Country</strong>, and <strong>Success</strong> (login).</p>
<table id="dataset1">
<tr><th>Browser</th><th>Country</th><th>Success</th></tr>
<tr><td>Chrome</td><td>Italy</td><td>1</td></tr>
<tr><td>Firefox</td><td>Italy</td><td>1</td></tr>
<tr><td>Chrome</td><td>USA</td><td>0</td></tr>
<tr><td>Safari</td><td>UK</td><td>1</td></tr>
<tr><td>Chrome</td><td>Italy</td><td>0</td></tr>
<tr><td>Firefox</td><td>USA</td><td>1</td></tr>
</table>
<form id="uni-form">
<label><input type="checkbox" name="vars" value="Browser" checked> Browser</label>
<label><input type="checkbox" name="vars" value="Country"> Country</label>
<label><input type="checkbox" name="vars" value="Success"> Success</label>
<button>Compute Univariate Distribution</button>
</form>
<div id="uni-table-wrap"></div>
</div>

<div class="card">
<h2>4. Bivariate Distribution</h2>
<p>Select two variables to compute joint frequencies:</p>
<form id="bi-form">
<label><input type="checkbox" name="vars" value="Browser" checked> Browser</label>
<label><input type="checkbox" name="vars" value="Country" checked> Country</label>
<button>Compute Bivariate Distribution</button>
</form>
<div id="bi-table-wrap"></div>
</div>

<div class="card">
<h2>5. Letter Distribution & Caesar Cipher</h2>
<p>Type a text below, compute the letter distribution, apply Caesar cipher, then decode automatically using brute-force and language frequencies.</p>
<textarea id="text-input" rows="6">Voglio bere il latte e poi guardare il browser in Italia.</textarea>
<div style="margin-top:0.5rem;">
<label>Shift: <input type="number" id="shift" value="3" min="0" max="25"></label>
<button id="encrypt-btn">Encrypt</button>
<button id="brute-btn">Brute-force Decode</button>
<select id="lang-select">
<option value="italian" selected>Italian</option>
<option value="english">English</option>
</select>
<button id="lang-decode">Decode using Language</button>
</div>
<h4>Letter Distribution</h4>
<div id="letter-chart"></div>
<h4>Encrypted Text</h4>
<pre id="encrypted-text" style="background:rgba(0,0,0,0.2);padding:0.5rem;border-radius:4px;"></pre>
<h4>Decoded Text (Brute-force)</h4>
<pre id="brute-text" style="background:rgba(0,0,0,0.2);padding:0.5rem;border-radius:4px;"></pre>
<h4>Decoded Text (Language)</h4>
<pre id="lang-text" style="background:rgba(0,0,0,0.2);padding:0.5rem;border-radius:4px;"></pre>
</div>

</div>
<script>
// -------------------- Dataset Helpers --------------------
function readTable(tableId){
    const table = document.getElementById(tableId);
    const rows = Array.from(table.querySelectorAll('tr')).slice(1);
    const data = rows.map(r => {
        const cells = r.querySelectorAll('td');
        return {
            Browser: cells[0].textContent,
            Country: cells[1].textContent,
            Success: Number(cells[2].textContent)
        };
    });
    return data;
}

function groupCounts(data, keys){
    const map = new Map();
    data.forEach(r=>{
        const k = JSON.stringify(keys.map(kk=>r[kk]));
        map.set(k,(map.get(k)||0)+1);
    });
    return Array.from(map.entries()).map(([k,v])=>{
        const obj={};
        JSON.parse(k).forEach((val,i)=>obj[keys[i]]=val);
        obj.Frequency=v;
        return obj;
    });
}

function renderTable(data, containerId, keys){
    const wrap = document.getElementById(containerId);
    wrap.innerHTML='';
    const table = document.createElement('table');
    const tr = document.createElement('tr');
    keys.concat(['Frequency']).forEach(k=>{
        const th = document.createElement('th'); th.textContent=k; tr.appendChild(th);
    });
    table.appendChild(tr);
    data.forEach(r=>{
        const tr = document.createElement('tr');
        keys.concat(['Frequency']).forEach(k=>{
            const td = document.createElement('td'); td.textContent=r[k]; tr.appendChild(td);
        });
        table.appendChild(tr);
    });
    wrap.appendChild(table);
}

// Univariate
document.getElementById('uni-form').addEventListener('submit', e=>{
    e.preventDefault();
    const keys = Array.from(document.querySelectorAll('#uni-form input[name=vars]:checked')).map(x=>x.value);
    if(keys.length===0) return;
    const data = readTable('dataset1');
    const result = groupCounts(data, keys.slice(0,3));
    renderTable(result,'uni-table-wrap',keys.slice(0,3));
});

// Bivariate
document.getElementById('bi-form').addEventListener('submit', e=>{
    e.preventDefault();
    const keys = Array.from(document.querySelectorAll('#bi-form input[name=vars]:checked')).map(x=>x.value);
    if(keys.length!==2) return alert('Select exactly 2 variables');
    const data = readTable('dataset1');
    const result = groupCounts(data, keys);
    renderTable(result,'bi-table-wrap',keys);
});

// -------------------- Letter Distribution & Caesar --------------------
function countLetters(text){
    const counts={};
    for(let i=0;i<26;i++) counts[String.fromCharCode(65+i)]=0;
    text.toUpperCase().split('').forEach(ch=>{
        if(ch>='A' && ch<='Z') counts[ch]++;
    });
    return counts;
}

function renderBar(counts, container){
    container.innerHTML='';
    Object.entries(counts).forEach(([letter,value])=>{
        const row=document.createElement('div'); row.className='bar-row';
        const lbl=document.createElement('div'); lbl.className='bar-label'; lbl.textContent=letter;
        const wrap=document.createElement('div'); wrap.className='bar-wrap';
        const fill=document.createElement('div'); fill.className='bar-fill'; fill.style.width=(value*5)+'px';
        wrap.appendChild(fill);
        const val=document.createElement('div'); val.className='bar-value'; val.textContent=value;
        row.appendChild(lbl); row.appendChild(wrap); row.appendChild(val);
        container.appendChild(row);
    });
}

function caesarShift(text,shift){
    return text.split('').map(ch=>{
        const c=ch.charCodeAt(0);
        if(c>=65 && c<=90) return String.fromCharCode((c-65+shift)%26+65);
        if(c>=97 && c<=122) return String.fromCharCode((c-97+shift)%26+97);
        return ch;
    }).join('');
}

function bruteForceDecrypt(cipher){
    const results=[];
    for(let s=0;s<26;s++) results.push(caesarShift(cipher,26-s));
    return results;
}

// Language frequency based
const langFreq={
    italian:{A:11.7,B:0.9,C:4.5,D:3.7,E:11.8,F:1.2,G:1.6,H:0.6,I:10.1,L:6.5,M:2.5,N:6.9,O:9.8,P:3.0,Q:0.5,R:6.0,S:4.9,T:5.0,U:3.6,V:2.0,Z:1.2},
    english:{A:8.2,B:1.5,C:2.8,D:4.3,E:12.7,F:2.2,G:2.0,H:6.1,I:7.0,J:0.15,K:0.77,L:4.0,M:2.4,N:6.7,O:7.5,P:1.9,Q:0.095,R:6.0,S:6.3,T:9.1,U:2.8,V:0.98,W:2.4,X:0.15,Y:2.0,Z:0.074}
};

function decodeWithLang(cipher,lang){
    const freq=langFreq[lang];
    const counts=countLetters(cipher);
    const sortedCipher=Object.entries(counts).sort((a,b)=>b[1]-a[1]);
    const sortedLang=Object.entries(freq).sort((a,b)=>b[1]-a[1]);
    const shift=(sortedCipher[0][0].charCodeAt(0)-sortedLang[0][0].charCodeAt(0)+26)%26;
    return caesarShift(cipher,26-shift);
}

// Events
document.getElementById('encrypt-btn').addEventListener('click',()=>{
    const txt=document.getElementById('text-input').value;
    const shift=Number(document.getElementById('shift').value);
    const cipher=caesarShift(txt,shift);
    document.getElementById('encrypted-text').textContent=cipher;
    renderBar(countLetters(txt),document.getElementById('letter-chart'));
});

document.getElementById('brute-btn').addEventListener('click',()=>{
    const cipher=document.getElementById('encrypted-text').textContent;
    const results=bruteForceDecrypt(cipher);
    document.getElementById('brute-text').textContent=results.join('\n');
});

document.getElementById('lang-decode').addEventListener('click',()=>{
    const cipher=document.getElementById('encrypted-text').textContent;
    const lang=document.getElementById('lang-select').value;
    document.getElementById('lang-text').textContent=decodeWithLang(cipher,lang);
});
</script>
</body>
</html>
