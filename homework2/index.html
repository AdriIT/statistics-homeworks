<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Laboratorio Interattivo - Dataset e Distribuzioni</title>
  <style>
    body {
      font-family: 'Inter', system-ui, sans-serif;
      background-color: #0f1724;
      color: #e6eef6;
      line-height: 1.6;
      margin: 0;
      padding: 0;
    }
    header {
      text-align: center;
      background-color: #0b1220;
      padding: 40px 20px;
      border-bottom: 2px solid #7dd3fc;
    }
    h1 { color: #7dd3fc; font-size: 2rem; margin-bottom: 8px; }
    p.lead { color: #9aa6b2; font-size: 1rem; }
    section {
      max-width: 900px;
      margin: 40px auto;
      background-color: #0b1220;
      border-radius: 14px;
      box-shadow: 0 0 20px rgba(0,0,0,0.3);
      padding: 24px;
    }
    h2 { color: #7dd3fc; margin-top: 0; font-size: 1.3rem; }
    ul { margin-left: 20px; padding-left: 10px; }
    li { margin-bottom: 8px; }
    textarea, select, input, button {
      background: #111a2b;
      color: #e6eef6;
      border: 1px solid #7dd3fc;
      border-radius: 6px;
      padding: 8px;
      width: 100%;
      margin-top: 8px;
      margin-bottom: 12px;
    }
    button {
      cursor: pointer;
      background: #7dd3fc;
      color: #0f1724;
      font-weight: bold;
      transition: 0.3s;
    }
    button:hover { background: #56b8e8; }
    canvas {
      background: #111a2b;
      display: block;
      margin: 10px auto;
      border-radius: 10px;
    }
    footer {
      text-align: center;
      color: #9aa6b2;
      margin: 40px 0 20px;
      font-size: 0.9rem;
    }
  </style>
</head>
<body>

<header>
  <h1>Cybersecurity & Statistica</h1>
  <p class="lead">Un laboratorio interattivo per esplorare dati, distribuzioni e crittografia.</p>
</header>

<section>
  <h2>1. Descrizione del Dataset</h2>
  <p>Il dataset rappresenta un insieme di dati osservati da un sistema informatico reale o simulato.  
  Ogni riga contiene le informazioni relative a un tentativo di accesso, indicando l’utente, il paese d’origine, il browser utilizzato e l’esito del tentativo.</p>

  <ul>
    <li><strong>UserID</strong>: identificativo numerico dell’utente.</li>
    <li><strong>Country</strong>: paese da cui proviene il login.</li>
    <li><strong>Browser</strong>: applicazione usata per accedere.</li>
    <li><strong>Success</strong>: indica se l’accesso è riuscito (1) o fallito (0).</li>
  </ul>

  <table id="LoginAttempts" border="1" style="width:100%; text-align:center; border-collapse:collapse; margin-top:10px;">
    <thead style="background:#111a2b;">
      <tr><th>UserID</th><th>Country</th><th>Browser</th><th>Success</th></tr>
    </thead>
    <tbody>
      <tr><td>1</td><td>Italy</td><td>Chrome</td><td>1</td></tr>
      <tr><td>2</td><td>Germany</td><td>Firefox</td><td>0</td></tr>
      <tr><td>1</td><td>Italy</td><td>Edge</td><td>0</td></tr>
      <tr><td>3</td><td>USA</td><td>Chrome</td><td>1</td></tr>
      <tr><td>2</td><td>Germany</td><td>Safari</td><td>1</td></tr>
      <tr><td>4</td><td>France</td><td>Chrome</td><td>0</td></tr>
      <tr><td>3</td><td>USA</td><td>Firefox</td><td>1</td></tr>
    </tbody>
  </table>

  <label for="columnSelect">Seleziona la colonna per la distribuzione:</label>
  <select id="columnSelect">
    <option value="Country">Country</option>
    <option value="Browser">Browser</option>
    <option value="Success">Success</option>
  </select>
  <button onclick="computeDistribution()">Calcola distribuzione</button>
  <pre id="sqlOutput" style="white-space:pre-wrap; background:#111a2b; padding:10px; border-radius:10px;"></pre>
  <div id="tableResult"></div>
</section>

<section>
  <h2>2. Descrizione della Distribuzione</h2>
  <p>Una <strong>distribuzione</strong> descrive come si ripetono i valori all’interno del dataset.  
  Ad esempio, osservando la distribuzione dei browser usati o dei paesi da cui avvengono gli accessi, è possibile identificare tendenze o anomalie.</p>
  <p>Le distribuzioni sono fondamentali in cybersecurity perché permettono di riconoscere comportamenti sospetti, come accessi ripetuti da una stessa area geografica o da un browser insolito.</p>
</section>

<section>
  <h2>3. Distribuzione delle Parole nei Testi</h2>
  <p>Le distribuzioni non si applicano solo ai numeri: anche i testi mostrano schemi statistici.  
  In questo esempio analizziamo la <strong>frequenza delle parole</strong> in brevi estratti legati alla sicurezza informatica.</p>

  <select id="textSelect" onchange="analyzeText()">
    <option value="phishing">E-mail di phishing</option>
    <option value="password">Messaggio su password</option>
    <option value="firewall">Avviso di firewall</option>
  </select>

  <canvas id="chartWords" width="600" height="200"></canvas>
</section>

<section>
  <h2>4. Cifrario di Cesare: Applicazione Pratica</h2>
  <p>Il <strong>cifrario di Cesare</strong> sposta ogni lettera del messaggio di un numero fisso di posizioni nell’alfabeto.  
  Di seguito puoi provare a cifrare e decifrare una frase legata al tema della sicurezza digitale.</p>

  <label for="cipherInput">Testo da cifrare:</label>
  <textarea id="cipherInput" rows="3" placeholder="Scrivi qui il testo...">password leaks are dangerous</textarea>

  <label for="shiftInput">Spostamento (shift):</label>
  <input type="number" id="shiftInput" value="4" min="1" max="25" />

  <button onclick="encryptText()">Cifra</button>
  <textarea id="encryptedOutput" rows="3" readonly></textarea>

  <h3>Decrittazione automatica tramite analisi di frequenza</h3>
  <select id="langSelect">
    <option value="english">Inglese</option>
    <option value="italian">Italiano</option>
  </select>
  <button onclick="decryptFrequency()">Decifra</button>
  <textarea id="decryptedOutput" rows="3" readonly></textarea>

  <canvas id="cipherChart" width="600" height="200"></canvas>
</section>

<footer>
  © 2025 – Laboratorio Interattivo di Statistica e Cybersecurity
</footer>

<script>
function computeDistribution() {
  const col = document.getElementById('columnSelect').value;
  const rows = document.querySelectorAll('#LoginAttempts tbody tr');
  const colIndex = {UserID:1, Country:2, Browser:3, Success:4}[col];
  const data = {};
  rows.forEach(r => {
    const value = r.querySelector(`td:nth-child(${colIndex})`).textContent;
    data[value] = (data[value] || 0) + 1;
  });
  let resultHTML = '<table border="1" style="width:100%; border-collapse:collapse; text-align:center;"><tr><th>' + col + '</th><th>Conteggio</th></tr>';
  Object.entries(data).forEach(([k,v]) => resultHTML += `<tr><td>${k}</td><td>${v}</td></tr>`);
  resultHTML += '</table>';
  document.getElementById('tableResult').innerHTML = resultHTML;
  document.getElementById('sqlOutput').textContent = `SELECT ${col}, COUNT(*) AS Conteggio FROM LoginAttempts GROUP BY ${col};`;
}

const texts = {
  phishing: "Dear user your account is suspended please click here to verify your login information",
  password: "Always use strong passwords and avoid reusing the same one on multiple sites",
  firewall: "Firewall blocked multiple unauthorized attempts to access the system"
};

function analyzeText() {
  const key = document.getElementById('textSelect').value;
  const words = texts[key].toLowerCase().split(/\W+/).filter(w => w.length > 2);
  const freq = {};
  for (let w of words) freq[w] = (freq[w] || 0) + 1;
  renderChart(freq, 'chartWords');
}

function renderChart(freq, canvasId) {
  const canvas = document.getElementById(canvasId);
  const ctx = canvas.getContext('2d');
  ctx.clearRect(0,0,canvas.width,canvas.height);
  const labels = Object.keys(freq);
  const max = Math.max(...Object.values(freq));
  const barWidth = canvas.width / labels.length;
  labels.forEach((l,i)=>{
    const h = (freq[l]/max)*canvas.height*0.85;
    ctx.fillStyle = '#7dd3fc';
    ctx.fillRect(i*barWidth, canvas.height - h, barWidth-2, h);
    ctx.fillStyle = 'black';
    ctx.font = '12px sans-serif';
    ctx.fillText(l, i*barWidth + 3, canvas.height - 5);
  });
}

function encryptText() {
  const text = document.getElementById('cipherInput').value.toUpperCase();
  const shift = parseInt(document.getElementById('shiftInput').value);
  const result = text.replace(/[A-Z]/g, c => String.fromCharCode((c.charCodeAt(0)-65+shift)%26+65));
  document.getElementById('encryptedOutput').value = result;
  const freq = {};
  for (let ch of result) if(/[A-Z]/.test(ch)) freq[ch] = (freq[ch]||0)+1;
  renderChart(freq, 'cipherChart');
}

const refFreq = {
  english: { E:12.7, T:9.1, A:8.2, O:7.5, I:7.0, N:6.7, S:6.3, H:6.1, R:6.0, D:4.3 },
  italian: { E:11.8, A:11.7, I:10.1, O:9.8, N:6.9, T:6.2, R:6.1, L:5.8, S:4.9, C:4.5 }
};

function decryptFrequency() {
  const cipher = document.getElementById('encryptedOutput').value;
  const lang = document.getElementById('langSelect').value;
  let bestShift = 0, bestScore = Infinity;
  for(let s=0;s<26;s++){
    const test = cipher.replace(/[A-Z]/g,c=>String.fromCharCode((c.charCodeAt(0)-65-s+26)%26+65));
    const freq = {};
    for(let ch of test) if(/[A-Z]/.test(ch)) freq[ch]=(freq[ch]||0)+1;
    const total = Object.values(freq).reduce((a,b)=>a+b,0);
    let score=0;
    for(const [k,v] of Object.entries(refFreq[lang])) score+=Math.abs((freq[k]||0)/total*100-v);
    if(score<bestScore){bestScore=score;bestShift=s;}
  }
  const decrypted = cipher.replace(/[A-Z]/g,c=>String.fromCharCode((c.charCodeAt(0)-65-bestShift+26)%26+65));
  document.getElementById('decryptedOutput').value = decrypted;
}

window.onload = () => {
  computeDistribution();
  analyzeText();
  encryptText();
};
</script>

</body>
</html>
