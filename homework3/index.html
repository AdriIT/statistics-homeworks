<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Homework 3: RSA Frequency Analysis</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
<style>
  body { font-family: 'Roboto', sans-serif; background:#0f1724; color:#e6eef6; margin:0; padding:20px;}
  .container { max-width:950px; margin:0 auto; display:flex; flex-direction:column; gap:20px;}
  h1,h2,h3,h4 { color:#7dd3fc; margin:10px 0;}
  input, textarea { width:100%; padding:10px; border-radius:10px; border:none; margin-bottom:12px; font-size:14px; background:rgba(0,0,0,0.2); color:#fff;}
  button { padding:8px 14px; border:none; border-radius:10px; cursor:pointer; margin-right:8px; font-weight:700;}
  .blue { background:#7dd3fc; color:#000; } .green { background:#22c55e; color:#000; } .orange { background:#f97316; color:#000; }
  .card { background:#0b1220; border-radius:14px; padding:20px; display:flex; flex-direction:column; gap:12px; box-shadow:0 0 0 1px rgba(255,255,255,0.05) inset;}
  .bar-group { display:flex; align-items:center; gap:6px; margin:3px 0; }
  .bar-label { width:20px; text-align:center; color:#9aa6b2; font-weight:700; }
  .bar-wrap { flex:1; height:16px; background:rgba(255,255,255,0.05); border-radius:6px; overflow:hidden; position:relative; }
  .bar-fill { height:100%; background:#7dd3fc; }
  .bar-value { position:absolute; right:4px; color:#fff; font-weight:700; font-size:12px; top:0; }
  .home-link { display:inline-block; margin-bottom:20px; color:#7dd3fc; text-decoration:none; font-weight:700; }
  .section-buttons { display:flex; flex-wrap:wrap; gap:10px; margin-bottom:10px; }
  .result-box { background:rgba(255,255,255,0.05); padding:12px; border-radius:10px; }
</style>
</head>
<body>
<div class="container">
  <a class="home-link" href="index.html">üè† Home</a>
  <h1>Homework 3: RSA Frequency Analysis</h1>

  <!-- RSA Parameters -->
  <div class="card">
    <h2>1. RSA Parameters</h2>
    <label>Prime p:<input type="number" id="p-val" value="61" min="2"></label>
    <label>Prime q:<input type="number" id="q-val" value="53" min="2"></label>
    <label>Public exponent e:<input type="number" id="e-val" value="17" min="2"></label>
    <div class="section-buttons">
      <button id="btn-generate-keys" class="blue">Generate Keys</button>
    </div>
    <div class="result-box" id="key-display"></div>
  </div>

  <!-- Encryption -->
  <div class="card">
    <h2>2. Text Encryption</h2>
    <textarea id="rsa-input" rows="3">HELLO WORLD</textarea>
    <div class="section-buttons">
      <button id="btn-encrypt" class="blue">Encrypt with RSA</button>
    </div>
    <div class="result-box"><strong>Ciphertext:</strong> <span id="rsa-output"></span></div>
  </div>

  <!-- Decryption with Private Key -->
  <div class="card">
    <h2>3. Decryption with Private Key</h2>
    <div class="section-buttons">
      <button id="btn-decrypt-key" class="blue">Decrypt with Private Key</button>
    </div>
    <div class="result-box"><strong>Decrypted text:</strong> <span id="rsa-decrypted-key"></span></div>
  </div>

  <!-- Decryption with Frequency Analysis -->
  <div class="card">
    <h2>4. Decryption with Frequency Analysis</h2>
    <p>Try to decode the message by analyzing the language's alphabet distribution. Candidate plaintexts are scored by MSE against English letter frequencies; the lowest MSE is the best guess.</p>
    <div class="section-buttons">
      <button id="btn-decrypt-freq" class="blue">Frequency Analysis Attack</button>
    </div>
    <div class="result-box"><strong>Decrypted text:</strong> <span id="rsa-decrypted-freq"></span></div>
    <div id="freq-bars"></div>
    <div id="lang-result"></div>
  </div>

</div>

<script>
  // Utilities
  function gcd(a,b){ return b===0?a:gcd(b,a%b); }
  function modInverse(e, phi){
    let [old_r,r]=[phi,e]; let [old_s,s]=[0,1];
    while(r!==0){ const q=Math.floor(old_r/r); [old_r,r]=[r,old_r-q*r]; [old_s,s]=[s,old_s-q*s]; }
    if(old_r!==1) return null; return (old_s+phi)%phi;
  }
  function modPow(base, exp, mod){
    let result=1n; base=BigInt(base)%BigInt(mod); exp=BigInt(exp); mod=BigInt(mod);
    while(exp>0n){ if(exp%2n===1n) result=(result*base)%mod; base=(base*base)%mod; exp>>=1n;}
    return result;
  }

  let n, phi, e, d;

  document.getElementById('btn-generate-keys').onclick = ()=>{
    const p=parseInt(document.getElementById('p-val').value);
    const q=parseInt(document.getElementById('q-val').value);
    e=parseInt(document.getElementById('e-val').value);
    n=p*q; phi=(p-1)*(q-1);
    if(gcd(e,phi)!==1){ alert('e not coprime with œÜ(n)'); return;}
    d=modInverse(e,phi);
    document.getElementById('key-display').innerHTML=`Public Key (e,n)=(${e},${n}) | Private Key (d,n)=(${d},${n})`;
  };

  function textToNums(text){ return text.toUpperCase().replace(/[^A-Z]/g,'').split('').map(c=>c.charCodeAt(0)-65);}
  function numsToText(nums){ return nums.map(n=>String.fromCharCode((n%26)+65)).join(''); }

  // Encrypt
  document.getElementById('btn-encrypt').onclick=()=>{
    if(!n||!e){ alert('Generate keys first'); return; }
    const nums=textToNums(document.getElementById('rsa-input').value);
    const encrypted=nums.map(num=>modPow(num,e,n).toString());
    document.getElementById('rsa-output').textContent=encrypted.join(' ');
  };

  // Decrypt with private key
  document.getElementById('btn-decrypt-key').onclick=()=>{
    if(!n||!d){ alert('Generate keys first'); return; }
    const encText=document.getElementById('rsa-output').textContent.trim();
    if(!encText){ alert('Encrypt text first'); return; }
    const enc=encText.split(/\s+/).map(BigInt);
    const decNums=enc.map(c=>Number(modPow(c,BigInt(d),BigInt(n))));
    const decText=numsToText(decNums);
    document.getElementById('rsa-decrypted-key').textContent=decText;
  };

  // Decrypt with frequency analysis
  document.getElementById('btn-decrypt-freq').onclick=()=>{
    const encText=document.getElementById('rsa-output').textContent.trim();
    if(!encText){ alert('Encrypt text first'); return; }
    const enc=encText.split(/\s+/).map(BigInt);

    const candidates=[];
    for(let trialD=1; trialD<=phi; trialD++){
      const decNums=enc.map(c=>Number(modPow(c,BigInt(trialD),BigInt(n))));
      if(decNums.every(n=>n>=0 && n<26)){
        candidates.push({text: numsToText(decNums), d: trialD});
      }
    }
    if(candidates.length===0){ alert('No valid candidates found'); return; }

    const englishProfile={A:8.12,B:1.49,C:2.78,D:4.25,E:12.02,F:2.23,G:2.02,H:6.09,I:6.97,J:0.15,K:0.77,L:4.03,M:2.41,N:6.75,O:7.51,P:1.93,Q:0.1,R:5.99,S:6.33,T:9.06,U:2.76,V:0.98,W:2.36,X:0.15,Y:1.97,Z:0.07};
    function freq(text){
      const counts={}; for(let i=0;i<26;i++) counts[String.fromCharCode(65+i)]=0;
      text.split('').forEach(c=>{ if(c>='A'&&c<='Z') counts[c]++; });
      return counts;
    }
    function mse(obs, profile){
      const total=Object.values(obs).reduce((a,b)=>a+b,0);
      let sum=0;
      for(const l in obs){
        const exp=total*(profile[l]||0)/100;
        sum+=((obs[l]-exp)**2);
      }
      return sum/26;
    }

    let bestCandidate=candidates[0];
    let lowestMSE=mse(freq(bestCandidate.text),englishProfile);
    candidates.forEach(c=>{
      const score=mse(freq(c.text),englishProfile);
      if(score<lowestMSE){ lowestMSE=score; bestCandidate=c; }
    });

    document.getElementById('rsa-decrypted-freq').textContent=bestCandidate.text;
    renderBars(freq(bestCandidate.text));
    document.getElementById('lang-result').textContent="Detected language: English üá∫üá∏ (by Frequency Analysis)";
  };

  function renderBars(counts){
    const container=document.getElementById('freq-bars'); container.innerHTML='';
    const maxVal=Math.max(...Object.values(counts));
    for(const [l,v] of Object.entries(counts)){
      const row=document.createElement('div'); row.className='bar-group';
      const label=document.createElement('div'); label.className='bar-label'; label.textContent=l;
      const wrap=document.createElement('div'); wrap.className='bar-wrap';
      const fill=document.createElement('div'); fill.className='bar-fill'; fill.style.width=`${v/maxVal*100}%`;
      const value=document.createElement('div'); value.className='bar-value'; value.textContent=v;
      wrap.appendChild(fill); wrap.appendChild(value); row.appendChild(label); row.appendChild(wrap); container.appendChild(row);
    }
  }
</script>
</body>
</html>
