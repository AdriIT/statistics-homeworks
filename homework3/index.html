<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Homework 3 - RSA Cipher & Language-Based Decoding</title>
  <style>
    :root {
      --bg: #0f1724;
      --card: #0b1220;
      --muted: #9aa6b2;
      --accent: #7dd3fc;
      --radius: 14px;
      --bar-color: #7dd3fc;
      --number-color: #ffffff;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: var(--bg);
      color: #e6eef6;
      margin: 0;
      padding: 20px;
      position: relative;
    }

    /* Tasto Home fisso in alto a sinistra */
    .home-link {
      position: fixed;
      top: 18px;
      left: 18px;
      background: var(--card);
      color: var(--accent);
      text-decoration: none;
      padding: 8px 14px;
      border-radius: 8px;
      font-weight: 600;
      transition: 0.3s;
      z-index: 1000;
    }
    .home-link:hover {
      background: var(--accent);
      color: var(--card);
    }
    .home-link::before {
      content: "← ";
      font-weight: bold;
    }

    .wrap { max-width: 950px; margin: 0 auto; }
    h1,h2,h3 { color: var(--accent); margin-bottom: 10px; }
    p { color: #d5dde6; margin-bottom: 12px; }
    .card {
      background: var(--card);
      border-radius: var(--radius);
      padding: 20px;
      margin: 20px 0;
      box-shadow: 0 0 0 1px rgba(255,255,255,0.05) inset;
    }

    textarea {
      width: 100%;
      background: rgba(0,0,0,0.2);
      color: #fff;
      padding: 10px;
      border-radius: 10px;
      border: none;
      resize: vertical;
      font-size: 15px;
      font-family: inherit;
    }

    button {
      background: var(--accent);
      color: #000;
      border: none;
      border-radius: 10px;
      padding: 8px 12px;
      font-weight: 700;
      cursor: pointer;
      font-family: inherit;
      margin-right: 8px;
    }
    button:hover { filter: brightness(0.9); }

    /* Input box style */
    .input-box {
      background: rgba(255,255,255,0.05);
      padding: 15px;
      border-radius: var(--radius);
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 10px;
      margin-top: 10px;
    }
    .input-field {
      display: flex;
      flex-direction: column;
    }
    .input-field label {
      font-weight: 600;
      color: var(--accent);
      margin-bottom: 4px;
      font-size: 14px;
    }
    .input-field input {
      background: rgba(255,255,255,0.08);
      color: #fff;
      border: none;
      padding: 8px;
      border-radius: 8px;
      font-size: 14px;
      width: 120px;
    }

    /* Frequency bars */
    .bar-row {
      display: flex;
      align-items: center;
      gap: 8px;
      margin: 4px 0;
    }
    .bar-label { width: 28px; text-align: center; color: #cfd7df; font-weight: 700; }
    .bar-wrap { flex: 1; height: 18px; background: rgba(255,255,255,0.06); border-radius: 5px; overflow: hidden; }
    .bar-fill { height: 100%; background: var(--bar-color); }
    .bar-value { width: 48px; text-align: right; color: var(--number-color); font-weight: 700; }
  </style>
</head>
<body>
  <a href="../index.html" class="home-link">Home</a>

  <div class="wrap">
    <h1>Homework 3 - RSA Cipher & Language-Based Decoding</h1>

    <div class="card">
      <h2>1. RSA Encryption Basics</h2>
      <p>RSA is a public-key encryption system using two primes <strong>p</strong> and <strong>q</strong> to generate keys. It’s based on modular arithmetic and the difficulty of factoring large numbers.</p>
    </div>

    <div class="card">
      <h2>2. Interactive RSA Encryption / Decryption</h2>
      <p>Use small primes for demonstration only. Type your message and test the encryption process.</p>

      <div class="input-box">
        <div class="input-field">
          <label for="p-val">Prime p:</label>
          <input type="number" id="p-val" value="11">
        </div>
        <div class="input-field">
          <label for="q-val">Prime q:</label>
          <input type="number" id="q-val" value="13">
        </div>
        <div class="input-field">
          <label for="e-val">Exponent e:</label>
          <input type="number" id="e-val" value="7">
        </div>
      </div>

      <textarea id="rsa-input" rows="3">HELLO WORLD</textarea>
      <div style="margin-top:10px;">
        <button id="btn-generate-keys">Generate Keys</button>
        <button id="btn-encrypt-rsa">Encrypt</button>
        <button id="btn-decrypt-rsa">Decrypt</button>
      </div>

      <p><strong>Public Key:</strong> <span id="pubkey"></span></p>
      <p><strong>Private Key:</strong> <span id="privkey"></span></p>
      <h4>Encrypted Message:</h4>
      <textarea id="rsa-output" rows="3" readonly></textarea>
      <h4>Decrypted Message:</h4>
      <textarea id="rsa-decrypted" rows="3" readonly></textarea>
    </div>

    <div class="card">
      <h2>3. Language Distribution Decoder</h2>
      <p>This tool compares the decrypted text’s letter frequencies to English and Italian distributions.</p>
      <button id="btn-analyze-lang">Analyze Language Distribution</button>
      <div id="lang-result" style="margin-top:12px;"></div>
      <div id="freq-bars" style="margin-top:12px;"></div>
    </div>
  </div>

  <script>
    // Basic RSA
    function gcd(a,b){ return b===0?a:gcd(b,a%b); }
    function modInverse(e,phi){ for(let d=1;d<phi;d++){ if((d*e)%phi===1) return d; } return null; }
    function modPow(base, exp, mod){
      let res = 1n, b = BigInt(base), e = BigInt(exp), m = BigInt(mod);
      while(e > 0){
        if(e % 2n === 1n) res = (res * b) % m;
        b = (b*b) % m;
        e = e / 2n;
      }
      return res;
    }

    let n, e, d;
    document.getElementById('btn-generate-keys').onclick = () => {
      const p = parseInt(document.getElementById('p-val').value);
      const q = parseInt(document.getElementById('q-val').value);
      e = parseInt(document.getElementById('e-val').value);
      n = p*q;
      const phi = (p-1)*(q-1);
      d = modInverse(e, phi);
      document.getElementById('pubkey').textContent = `(${e}, ${n})`;
      document.getElementById('privkey').textContent = `(${d}, ${n})`;
    };

    document.getElementById('btn-encrypt-rsa').onclick = () => {
      const text = document.getElementById('rsa-input').value.toUpperCase();
      const encrypted = text.split('').map(ch => {
        const code = ch.charCodeAt(0);
        if (code >= 65 && code <= 90) {
          return Number(modPow(code-65, BigInt(e), BigInt(n)));
        }
        return ch;
      });
      document.getElementById('rsa-output').value = encrypted.join(' ');
    };

    document.getElementById('btn-decrypt-rsa').onclick = () => {
      const cipher = document.getElementById('rsa-output').value.split(' ');
      const decrypted = cipher.map(el => {
        if (!isNaN(el)) {
          const m = Number(modPow(BigInt(el), BigInt(d), BigInt(n)));
          return String.fromCharCode((m % 26) + 65);
        }
        return el;
      }).join('');
      document.getElementById('rsa-decrypted').value = decrypted;
    };

    // Language analysis
    const langProfiles = {
      italian: {A:11.74,B:0.92,C:4.5,D:3.73,E:11.79,F:1.01,G:1.65,H:0.64,I:10.14,L:6.51,M:2.51,N:6.88,O:9.83,P:3.05,Q:0.51,R:6.37,S:4.98,T:5.62,U:3.01,V:2.1,Z:1.18},
      english: {A:8.12,B:1.49,C:2.78,D:4.25,E:12.02,F:2.23,G:2.02,H:6.09,I:6.97,L:4.03,M:2.41,N:6.75,O:7.51,P:1.93,R:5.99,S:6.33,T:9.06,U:2.76,V:0.98,W:2.36,Y:1.97}
    };

    function countLetters(text) {
      const counts = {};
      for (let i = 65; i <= 90; i++) counts[String.fromCharCode(i)] = 0;
      text.toUpperCase().split('').forEach(ch => {
        if (ch >= 'A' && ch <= 'Z') counts[ch]++;
      });
      return counts;
    }

    function calculateChiSquare(obs, exp) {
      const total = Object.values(obs).reduce((a,b)=>a+b,0);
      let chi = 0;
      for (let k in exp) {
        const expected = total * (exp[k]/100);
        const o = obs[k]||0;
        if (expected>0) chi += ((o-expected)**2)/expected;
      }
      return chi;
    }

    function renderBars(counts) {
      const container = document.getElementById('freq-bars');
      container.innerHTML = '';
      const max = Math.max(...Object.values(counts));
      Object.entries(counts).forEach(([letter,value]) => {
        const row = document.createElement('div');
        row.className = 'bar-row';
        row.innerHTML = `<div class="bar-label">${letter}</div>
          <div class="bar-wrap"><div class="bar-fill" style="width:${(value/max)*100}%"></div></div>
          <div class="bar-value">${value}</div>`;
        container.appendChild(row);
      });
    }

    document.getElementById('btn-analyze-lang').onclick = () => {
      const text = document.getElementById('rsa-decrypted').value;
      const obs = countLetters(text);
      renderBars(obs);
      const itChi = calculateChiSquare(obs, langProfiles.italian);
      const enChi = calculateChiSquare(obs, langProfiles.english);
      const best = itChi < enChi ? 'Italian' : 'English';
      document.getElementById('lang-result').innerHTML = `
        <p><strong>Italian χ²:</strong> ${itChi.toFixed(2)}<br>
        <strong>English χ²:</strong> ${enChi.toFixed(2)}</p>
        <h4>→ Closest Language: <span style="color:var(--accent)">${best}</span></h4>`;
    };
  </script>
</body>
</html>
