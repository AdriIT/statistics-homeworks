<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Homework 3 - RSA & Language Estimation</title>
<style>
:root {
    --bg: #0f1724;
    --card: #0b1220;
    --muted: #9aa6b2;
    --accent: #7dd3fc;
    --radius: 14px;
    --bar-color: #7dd3fc;
}
* { box-sizing: border-box; }
body {
    font-family: 'Roboto', sans-serif;
    background: var(--bg);
    color: #e6eef6;
    margin: 0;
    padding: 20px;
}
.wrap { max-width: 1000px; margin: 0 auto; }
h1,h2,h3,h4 { color: var(--accent); margin-bottom: 10px; }
p { color: #d5dde6; margin-bottom: 12px; }

.card {
    background: var(--card);
    border-radius: var(--radius);
    padding: 20px;
    margin-bottom: 20px;
}

input[type=number], textarea {
    background: rgba(255,255,255,0.1);
    border: none;
    border-radius: 8px;
    color: #fff;
    padding: 6px 8px;
    font-family: inherit;
}
textarea { width: 100%; resize: vertical; font-size: 15px; }

button {
    background: var(--accent);
    color: #000;
    border: none;
    border-radius: 10px;
    padding: 8px 12px;
    font-weight: 700;
    cursor: pointer;
    font-family: inherit;
    margin: 4px 2px;
}
button:hover { filter: brightness(0.9); }

.bar-row { display: flex; align-items: center; gap: 8px; margin: 4px 0; }
.bar-label { width: 28px; text-align: center; color: #cfd7df; font-weight: 700; }
.bar-wrap { flex: 1; height: 18px; background: rgba(255,255,255,0.06); border-radius: 5px; overflow: hidden; }
.bar-fill { height: 100%; background: var(--bar-color); }
.bar-value { width: 48px; text-align: right; color: #fff; font-weight: 700; }

.brute-list { max-height: 300px; overflow-y: auto; background: rgba(0,0,0,0.1); border-radius: 8px; padding: 10px; }
.brute-row { display: flex; align-items: center; gap: 10px; padding: 6px 0; border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 14px; }
.shift-badge { min-width: 50px; text-align: center; font-weight: 800; background: rgba(125,211,252,0.25); color: #fff; border-radius: 6px; padding: 3px 6px; font-size: 12px; }
.decode-text { flex: 1; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; background: rgba(0,0,0,0.15); padding: 4px 8px; border-radius: 4px; color: #e0e0e0; }

.home-link { color: var(--accent); display: inline-block; margin-bottom: 16px; text-decoration: none; font-weight: 700; }
.home-link:hover { text-decoration: underline; }
</style>
</head>
<body>
<div class="wrap">
    <a href="../index.html" class="home-link">Home</a>
    <header>
        <h1>Homework 3: RSA & Language Estimation</h1>
    </header>

    <div class="card">
        <h2>Introduction</h2>
        <p>This interactive page demonstrates a simple RSA encryption/decryption algorithm using small prime numbers for educational purposes. Users can input primes <strong>p</strong> and <strong>q</strong>, and a public exponent <strong>e</strong> to generate RSA keys. Text can then be encrypted with the public key and decrypted using the private key.</p>
        <p>Additionally, the decrypted text can be analyzed for letter frequency distribution to estimate the most likely language (Italian or English) based on typical alphabet usage.</p>
    </div>

    <div class="card">
        <h2>1. RSA Parameters</h2>
        <div style="display:flex; flex-direction:column; gap:10px;">
            <div>
                <label for="rsa-p">Prime p:</label><br>
                <input type="number" id="rsa-p" value="61" min="2">
            </div>
            <div>
                <label for="rsa-q">Prime q:</label><br>
                <input type="number" id="rsa-q" value="53" min="2">
            </div>
            <div>
                <label for="rsa-e">Public exponent e:</label><br>
                <input type="number" id="rsa-e" value="17" min="2">
            </div>
            <button id="btn-gen-keys" style="background-color:#7dd3fc; color:#000;">Generate Keys</button>
        </div>
        <div id="rsa-keys" style="margin-top: 10px;"></div>
    </div>

    <div class="card">
        <h2>2. Enter Text to Encrypt</h2>
        <textarea id="text-input" rows="3">hello world</textarea>
        <button id="btn-encrypt" style="background-color:#7dd3fc; color:#000;">Encrypt</button>
        <div style="margin-top:10px;">
            <h4>Encrypted Text:</h4>
            <textarea id="cipher-output" rows="3" readonly></textarea>
        </div>
    </div>

    <div class="card">
        <h2>3. Decryption & Language Estimation</h2>
        <div style="margin-bottom:12px;">
            <button id="btn-decrypt-key" style="background-color:#7dd3fc; color:#000;">Decrypt with Private Key</button>
            <button id="btn-decrypt-freq" style="background-color:#7dd3fc; color:#000;">Decrypt & Estimate Language</button>
        </div>
        <div id="decryption-output">
            <h4>Decrypted Text (Private Key):</h4>
            <textarea id="decrypted-key" rows="3" readonly></textarea>

            <h4>Decrypted Text with Estimated Language</h4>
            <div>Detected Language: <span id="estimated-lang">-</span></div>
            <textarea id="decrypted-lang" rows="4" readonly></textarea>
        </div>
    </div>

    <div class="card">
        <h2>4. Letter Frequency Distribution</h2>
        <div id="freq-bars"></div>
    </div>
</div>

<script>
// RSA Functions
function modPow(base, exp, mod){
    let result=1n; base=BigInt(base)%BigInt(mod);
    while(exp>0n){
        if(exp%2n===1n) result=(result*base)%BigInt(mod);
        base=(base*base)%BigInt(mod); exp=exp/2n;
    } return result;
}
function modInv(a, m){
    let m0=m,x0=0n,x1=1n; a=BigInt(a); m=BigInt(m);
    if(m===1n) return 0n;
    while(a>1n){
        let q=a/m; [a,m]=[m,a%m]; [x0,x1]=[x1-q*x0,x0];
    }
    return x1<0n?x1+m0:x1;
}
function encryptRSA(text,e,n){ return text.split('').map(c=>modPow(c.charCodeAt(0),e,n).toString()).join(' '); }
function decryptRSA(cipher,d,n){ return cipher.split(' ').map(c=>String.fromCharCode(Number(modPow(BigInt(c),d,n)))).join(''); }

// Letter Frequency
function countLetters(text){ const counts={}; for(let i=0;i<26;i++) counts[String.fromCharCode(65+i)]=0; text.toUpperCase().split('').forEach(c=>{if(c>='A'&&c<='Z') counts[c]++;}); return counts; }
function renderBars(counts,container){ container.innerHTML=''; const max=Math.max(1,...Object.values(counts)); for(const[l,val]of Object.entries(counts)){ const row=document.createElement('div'); row.className='bar-row'; const lbl=document.createElement('div'); lbl.className='bar-label'; lbl.textContent=l; const wrap=document.createElement('div'); wrap.className='bar-wrap'; const fill=document.createElement('div'); fill.className='bar-fill'; fill.style.width=(val/max*100)+'%'; const valDiv=document.createElement('div'); valDiv.className='bar-value'; valDiv.textContent=val; wrap.appendChild(fill); row.appendChild(lbl); row.appendChild(wrap); row.appendChild(valDiv); container.appendChild(row); }}

// Language Profiles
const langProfiles = {
    italian: {A:11.74,B:0.92,C:4.50,D:3.73,E:11.79,F:1.01,G:1.65,H:0.64,I:10.14,J:0.02,K:0.02,L:6.51,M:2.51,N:6.88,O:9.83,P:3.05,Q:0.51,R:6.37,S:4.98,T:5.62,U:3.01,V:2.10,W:0.02,X:0.02,Y:0.02,Z:1.18},
    english: {A:8.12,B:1.49,C:2.78,D:4.25,E:12.02,F:2.23,G:2.02,H:6.09,I:6.97,J:0.15,K:0.77,L:4.03,M:2.41,N:6.75,O:7.51,P:1.93,Q:0.10,R:5.99,S:6.33,T:9.06,U:2.76,V:0.98,W:2.36,X:0.15,Y:1.97,Z:0.07}
};

function chiSquare(observed, profile){
    const total=Object.values(observed).reduce((a,b)=>a+b,0);
    let sum=0;
    for(let i=0;i<26;i++){
        const l=String.fromCharCode(65+i);
        const expected=total*(profile[l]/100);
        const obs=observed[l];
        sum+=Math.pow(obs-expected,2)/expected;
    }
    return sum;
}

function estimateLanguage(text){
    const counts=countLetters(text);
    let bestLang='-'; let bestScore=Infinity;
    for(const [lang,profile] of Object.entries(langProfiles)){
        const score=chiSquare(counts,profile);
        if(score<bestScore){ bestScore=score; bestLang=lang; }
    }
    return bestLang;
}

// Event Handlers
let n, phi, d;
document.getElementById('btn-gen-keys').onclick=function(){
    const p=BigInt(document.getElementById('rsa-p').value);
    const q=BigInt(document.getElementById('rsa-q').value);
    const e=BigInt(document.getElementById('rsa-e').value);
    n=p*q; phi=(p-1n)*(q-1n); d=modInv(e,phi);
    document.getElementById('rsa-keys').innerHTML=`n=${n} | Ï†(n)=${phi}<br>Public Key (e)=${e} | Private Key (d)=${d}`;
};

document.getElementById('btn-encrypt').onclick=function(){
    if(!n||!d){alert('Generate keys first'); return;}
    const e=BigInt(document.getElementById('rsa-e').value);
    const text=document.getElementById('text-input').value;
    const cipher=encryptRSA(text,e,n);
    document.getElementById('cipher-output').value=cipher;
    renderBars(countLetters(text),document.getElementById('freq-bars'));
};

document.getElementById('btn-decrypt-key').onclick=function(){
    if(!d||!n){alert('Generate keys first'); return;}
    const cipher=document.getElementById('cipher-output').value;
    document.getElementById('decrypted-key').value=decryptRSA(cipher,d,n);
};

document.getElementById('btn-decrypt-freq').onclick=function(){
    if(!d||!n){alert('Generate keys first'); return;}
    const cipher=document.getElementById('cipher-output').value;
    const decrypted=decryptRSA(cipher,d,n);
    const lang=estimateLanguage(decrypted);
    document.getElementById('decrypted-lang').value=decrypted;
    document.getElementById('estimated-lang').textContent=lang;
};
</script>
</body>
</html>
